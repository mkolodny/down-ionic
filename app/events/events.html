<ion-view id="events" hide-back-button="true" can-swipe-back="false">
  <ion-nav-title>
    <span id="nav-logo">Rallytap</span>
  </ion-nav-title>
  <ion-nav-buttons side="right">
    <button class="button button-clear icon"
            id="create-event-nav"
            ng-click="events.createEvent()"
            ontouchstart
            ><i class="fa fa-edit fa-lg"></i></button>
  </ion-nav-buttons>
  <ion-nav-buttons side="left">
    <button class="button button-clear icon"
            ng-click="events.myFriends()"
            ontouchstart
            ><i class="fa fa-users fa-lg"></i></button>
  </ion-nav-buttons>
  <ion-content id="events-content">
    <ion-refresher pulling-text="Pull to refresh..." on-refresh="events.refresh()"
                   ng-if="!events.isLoading" spinner="bubbles">
    </ion-refresher>
    <div id="spinner-container" ng-if="events.isLoading">
      <ion-spinner icon="bubbles"></ion-spinner>
    </div>
    <ion-list class="list-avatar" ng-if="events.items.length > 0">
      <ion-item collection-repeat="item in events.items track by item.id"
                item-width="100%"
                item-height="item.isDivider ? '23px' : '72px'"
                ng-class="{
                  'item-divider': item.isDivider,
                  'item-avatar': !item.isDivider,
                  'item-icon-right': !item.isDivider,
                  updated: !item.isDivider && !events.wasRead(item.newestMessage),
                  last: $last
                }">
        <!-- Divider -->
        <div ng-if="item.isDivider">
          <span class="divider-title">{{item.title}}</span>
          <div class="divider-line"></div>
        </div>

        <!-- Event -->
        <div ng-if="item.invitation"
             ng-click="events.viewEventChat(item)">
          <img class="item-image"
               ng-src="{{item.invitation.fromUser.getImageUrl()}}">
          <canvas class="chart chart-pie avatar-pie"
                  ng-repeat="color in ['#ffffff', 'rgb(217,217,217)']"
                  data="[
                    (100 - item.invitation.event.percentRemaining),
                    item.invitation.event.percentRemaining
                  ]"
                  ng-class="{
                    'white': (color==='#ffffff'),
                    'gray': (color==='rgb(217,217,217)')
                  }"
                  labels="['', '']"
                  colours="[color, 'rgba(0,0,0,0)']" width="53" height="53"
                  options="{segmentShowStroke: false, animation: false, responsive: false, showTooltips: false}"
                  ></canvas>
          <h2>{{item.invitation.event.title}}</h2>
          <p class="latest-message">
            <span ng-if="item.newestMessage.text"
                  >{{item.newestMessage.text}}</span>
            <span ng-if="!item.newestMessage.text"
                  >with {{item.invitation.fromUser.name}}</span>
          </p>
        </div>

        <!-- Friend -->
        <div ng-if="item.friend"
             ng-click="events.viewFriendChat(item)">
          <img class="item-image"
               ng-src="{{item.friend.getImageUrl()}}">
          <canvas class="chart chart-pie avatar-pie"
                  ng-if="item.match"
                  ng-repeat="color in ['#ffffff', 'rgb(217,217,217)']"
                  data="[
                    (100 - item.match.percentRemaining),
                    item.match.percentRemaining
                  ]"
                  ng-class="{
                    'white': (color==='#ffffff'),
                    'gray': (color==='rgb(217,217,217)')
                  }"
                  labels="['', '']"
                  colours="[color, 'rgba(0,0,0,0)']" width="53" height="53"
                  options="{segmentShowStroke: false, animation: false, responsive: false, showTooltips: false}"
                  ></canvas>
          <h2>{{item.friend.name}}</h2>
          <p class="latest-message">
            <span ng-if="item.newestMessage.text && events.isRecentMessage(item.newestMessage)">
              {{item.newestMessage.text}}
            </span>
            <span ng-if="!item.newestMessage.text || !events.isRecentMessage(item.newestMessage)">
              {{events.getDistanceAway(item.friend)}}
            </span>
          </p>
          <select-friend-button user="item.friend"></select-friend-button>
        </div>
      </ion-item>
    </ion-list>
    <ion-list id="add-friends"
              ng-if="!events.isLoading && events.items.length === 0">
      <ion-item class="item-divider">
        <span class="divider-title">Add Friends</span>
        <div class="divider-line"></div>
      </ion-item>
      <ion-item class="item-avatar"
                ng-click="events.addByUsername()">
        <img ng-src="images/Add_By_Username.png" alt="Username">
        <h2>Add by username</h2>
      </ion-item>
      <ion-item class="item-avatar"
                ng-click="events.addFromAddressBook()">
        <img ng-src="images/Add_From_Address_Book.png" alt="Address Book">
        <h2>Add from address book</h2>
      </ion-item>
      <ion-item class="item-avatar"
                ng-click="events.addFromFacebook()">
        <img ng-src="images/Add_From_Facebook.png" alt="Facebook">
        <h2>Add from Facebook</h2>
      </ion-item>
    </ion-list>
  </ion-content>
</ion-view>
