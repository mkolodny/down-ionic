<ion-view id="events" hide-back-button="true" can-swipe-back="false">
  <ion-nav-title>
    <span id="nav-logo">Down.</span>
  </ion-nav-title>
  <ion-nav-buttons side="primary">
    <button class="button button-clear icon" ng-click="events.myFriends()"
            ontouchstart
            ><i class="fa fa-users fa-lg"></i></button>
  </ion-nav-buttons>
  <ion-content id="events-content">
    <ion-refresher pulling-text="Pull to refresh..." on-refresh="events.refresh()"
                   ng-if="!events.isLoading" spinner="bubbles">
    </ion-refresher>
    <div id="spinner-container" ng-if="events.isLoading">
      <ion-spinner icon="bubbles"></ion-spinner>
    </div>
    <ion-list class="list-avatar">
      <ion-item collection-repeat="item in events.items track by item.id"
                item-width="100%"
                item-height="item.isDivider ? '23px' : '72px'"
                ng-class="{
                  'item-divider': item.isDivider,
                  'item-avatar': !item.isDivider,
                  'item-icon-right': !item.isDivider,
                  updated: !item.isDivider && item.invitation.event.latestMessage && !item.invitation.event.latestMessage.wasRead,
                  last: $last
                }"
                ng-click="item.isDivider ? null : events.viewEvent(item)">
        <!-- Divider -->
        <div ng-if="item.isDivider">
          <span class="divider-title">{{item.title}}</span>
          <div class="divider-line"></div>
        </div>

        <!-- Event -->
        <div ng-if="item.invitation">
          <img class="item-image"
               ng-src="{{item.invitation.fromUser.getImageUrl()}}">
          <canvas class="chart chart-pie"
                  ng-repeat="color in ['#ffffff', 'rgb(217,217,217)']"
                  data="[
                    (100 - item.invitation.event.percentRemaining),
                    item.invitation.event.percentRemaining
                  ]"
                  ng-class="{
                    'white': (color==='#ffffff'),
                    'gray': (color==='rgb(217,217,217)')
                  }"
                  labels="['', '']"
                  colours="[color, 'rgba(0,0,0,0)']" width="53" height="53"
                  options="{segmentShowStroke: false, animation: false, responsive: false, showTooltips: false}"
                  ></canvas>
          <h2>{{item.invitation.event.title}}</h2>
          <p class="latest-message">
            <span ng-if="item.invitation.event.latestMessage.text"
                  >{{item.invitation.event.latestMessage.text}}</span>
            <span ng-if="!item.invitation.event.latestMessage.text"
                  >with {{item.invitation.fromUser.name}}</span>
          </p>
        </div>

        <!-- Friend -->
        <div ng-if="item.friend">
          <img class="item-image"
               ng-src="{{item.friend.getImageUrl()}}">
          <h2>{{item.friend.name}}</h2>
          <p class="latest-message">
            <span ng-if="item.friend.latestMessage.text"
                  >{{item.friend.latestMessage.text}}</span>
            <!-- TODO:
            <span ng-if="!item.friend.latestMessage.text"
                  >{{item.friend.getDistanceAway()}} away</span>
            -->
          </p>
        </div>
      </ion-item>
    </ion-list>
    <ion-list id="add-friends">
      <ion-item class="item-divider"
                ng-class="{'below-items': events.items.length > 0}">
        <span class="divider-title">Add Friends</span>
        <div class="divider-line"></div>
      </ion-item>
      <ion-item class="item-avatar"
                ng-click="events.addByUsername()">
        <img ng-src="images/Add_By_Username.png" alt="Username">
        <h2>Add by username</h2>
      </ion-item>
      <ion-item class="item-avatar"
                ng-click="events.addFromAddressBook()">
        <img ng-src="images/Add_From_Address_Book.png" alt="Address Book">
        <h2>Add from address book</h2>
      </ion-item>
      <ion-item class="item-avatar"
                ng-click="events.addFromFacebook()">
        <img ng-src="images/Add_From_Facebook.png" alt="Facebook">
        <h2>Add from Facebook</h2>
      </ion-item>
    </ion-list>
  </ion-content>
  <ion-footer-bar class="bar-light" keyboard-attach>
    <div id="new-event-details">
      <input id="suggestion" placeholder="What are you down to do?"
             ng-model="events.newEvent.title">
      <div class="event-detail" ng-if="events.newEvent.hasDate">
        <i class="fa fa-calendar-o"></i>
        <div>
          <div>{{events.newEvent.datetime | date:'EEEE, MMM d'}}</div>
          <div>{{events.newEvent.datetime | date:'shortTime' | lowercase}}</div>
        </div>
      </div>
      <div class="event-detail" ng-if="events.newEvent.hasPlace">
        <i class="fa fa-map-marker"></i>
        <span>{{events.newEvent.place.name}}</span>
      </div>
      <div class="event-detail" ng-show="events.newEvent.hasComment">
        <i class="fa fa-comment-o"></i>
        <textarea id="comment" ng-model="events.newEvent.comment" msd-elastic
                  placeholder="Add a comment..." rows="1"></textarea>
      </div>
    </div>
    <div id="actions" class="footer-subheader">
      <a href="" ng-click="events.toggleHasDate()">
        <i class="fa fa-calendar-o"
           ng-class="{selected: events.newEvent.hasDate}"></i>
      </a>
      <a href="" ng-click="events.toggleHasPlace()">
        <i class="fa fa-map-marker"
           ng-class="{selected: events.newEvent.hasPlace}"></i>
      </a>
      <a href="" ng-click="events.toggleHasComment()">
        <i class="fa fa-comment-o"
           ng-class="{selected: events.newEvent.hasComment}"></i>
      </a>
      <button id="suggest" ng-click="events.inviteFriends()"
              ng-disabled="!events.newEvent.title">
        <i class="fa fa-arrow-right" ng-class="{enabled: events.newEvent.title}"
           ></i>
      </button>
    </div>
  </ion-footer-bar>
</ion-view>
